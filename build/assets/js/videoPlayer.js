"use strict";var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));require("regenerator-runtime/runtime");require("core-js/modules/es6.regexp.split");var _getBlobDuration=_interopRequireDefault(require("get-blob-duration")),videoContainer=document.getElementById("jsVideoPlayer"),videoPlayer=document.querySelector("#jsVideoPlayer video"),playBtn=document.getElementById("jsPlayButton"),volumeBtn=document.getElementById("jsVolumeButton"),fullScrnBtn=document.getElementById("jsFullScreen"),currentTime=document.getElementById("currentTime"),totalTime=document.getElementById("totalTime"),volumeRange=document.getElementById("jsVolume"),registerView=function(){var a=window.location.href.split("/videos/")[1];fetch("/api/".concat(a,"/view"),{method:"POST"})};function handlePlayClick(){videoPlayer.paused?(videoPlayer.play(),playBtn.innerHTML="<i class=\"fas fa-pause\"></i>",volumeRange.value=videoPlayer.volume):(volumeRange.value=0,videoPlayer.pause(),playBtn.innerHTML="<i class=\"fas fa-play\"></i>")}function handleVolumeClick(){videoPlayer.muted?(videoPlayer.muted=!1,volumeBtn.innerHTML="<i class=\"fas fa-volume-up\"></i>"):(videoPlayer.muted=!0,volumeBtn.innerHTML="<i class=\"fas fa-volume-mute\"></i>")}function exitFullScreen(){fullScrnBtn.innerHTML="<i class=\"fas fa-expand\"></i>",fullScrnBtn.addEventListener("click",goFullScreen),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function goFullScreen(){videoContainer.requestFullscreen?videoContainer.requestFullscreen():videoContainer.mozRequestFullScreen?videoContainer.mozRequestFullScreen():videoContainer.webkitRequestFullscreen?videoContainer.webkitRequestFullscreen():videoContainer.msRequestFullscreen&&videoContainer.msRequestFullscreen(),fullScrnBtn.innerHTML="<i class=\"fas fa-compress\"></i>",fullScrnBtn.removeEventListener("click",goFullScreen),fullScrnBtn.addEventListener("click",exitFullScreen)}var formatDate=function(a){var b=Math.floor,c=parseInt(a,10),d=b(c/3600),e=b((c-3600*d)/60),f=c-3600*d-60*e;return 10>d&&(d="0".concat(d)),10>e&&(e="0".concat(e)),10>f&&(f="0".concat(f)),"".concat(d,":").concat(e,":").concat(f)};function getCurrentTime(){currentTime.innerHTML=formatDate(Math.floor(videoPlayer.currentTime))}function setTotalTime(){return _setTotalTime.apply(this,arguments)}function _setTotalTime(){return _setTotalTime=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,c,d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch(videoPlayer.src).then(function(a){return a.blob()});case 2:return b=a.sent,a.next=5,(0,_getBlobDuration["default"])(b);case 5:c=a.sent,d=formatDate(c),totalTime.innerHTML=d,setInterval(getCurrentTime,1e3);case 9:case"end":return a.stop();}},a)})),_setTotalTime.apply(this,arguments)}function handleEnded(){registerView(),videoPlayer.currentTime=0,playBtn.innerHTML="<i class=\"fas fa-play\"></i>"}function handleDrag(a){var b=a.target.value;videoPlayer.volume=b,volumeBtn.innerHTML=.6<=b?"<i class=\"fas fa-volume-up\"></i>":.2<=b?"<i class=\"fas fa-volume-down\"></i>":"<i class=\"fas fa-volume-off\"></i>"}function init(){videoPlayer.volume=.5,playBtn.addEventListener("click",handlePlayClick),volumeBtn.addEventListener("click",handleVolumeClick),fullScrnBtn.addEventListener("click",goFullScreen),videoPlayer.addEventListener("loadedmetadata",setTotalTime),videoPlayer.addEventListener("ended",handleEnded),volumeRange.addEventListener("input",handleDrag)}videoContainer&&init();